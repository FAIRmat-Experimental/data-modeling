<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<definition category="application" extends="NXobject" name="NXiv_temp" type="group" xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <symbols>
        <doc>
             Variables used throughout the document, e.g. dimensions and important
             parameters
        </doc>
        <symbol name="N_different_voltages">
            <doc>
                 Number of elements in the scanned voltage array that were set during
                 the measurement
            </doc>
        </symbol>
        <symbol name="N_variables">
            <doc>
                 Number of additional variables read that are changed with the temperature
                 (can be understood as columns next to the temperature)
            </doc>
        </symbol>
        <symbol name="N_different_temperatures">
            <doc>
                 Number of different temperatures that are set
            </doc>
        </symbol>
    </symbols>
    <doc>
         Application definition for temperature-dependent IV curve measurements.

         In this application definition, times should be specified always together
         with an UTC offset.

         This is the application definition describing temperature dependent IV curve
         measurements. For this a temperature is set. After reaching the temperature,
         a voltage sweep is performed. For each voltage a current is measured.
         Then, the next desired temperature is set and an IV measurement is performed.
         The application definition defines:
         - elements of the experimental instrument
         - calibration information if available
         - parameters used to tune the state of the sample
         - sample description
    </doc>
    <group type="NXentry">
        <attribute name="version">
            <doc>
                 Version number to identify which definition of this application
                 definition was used for this entry/data.
            </doc>
        </attribute>
        <field name="definition" type="NX_CHAR">
            <doc>
                 NeXus NXDL schema to which this file conforms.
            </doc>
            <enumeration>
                <item value="NXiv_temp"/>
            </enumeration>
            <attribute name="url" optional="true" type="NX_CHAR">
                <doc>
                     URL where to find further material (documentation, examples)
                     relevant to the application definition
                </doc>
            </attribute>
        </field>
        <field name="experiment_identifier" type="NX_CHAR">
            <doc>
                 Unique identifier of the experiment, such as a (globally persistent)
                 unique identifier. The identifier is usually defined by the
                 facility or principle investigator. The identifier enables to link
                 experiments to e.g. proposals.
            </doc>
        </field>
        <field name="experiment_description" type="NX_CHAR">
            <doc>
                 Description of the exact experiment performed.
            </doc>
        </field>
        <field name="start_time" recommended="true" type="NX_DATE_TIME">
            <doc>
                 UTC offset should be specifiec.
            </doc>
        </field>
        <group optional="true" type="NXprocess">
            <doc>
                 Define the program that was used to generate the results file(s)
                 with measured data and metadata.
            </doc>
            <field name="program" type="NX_CHAR">
                <doc>
                     Commercial or otherwise defined given name of the program
                     (or a link to the instrument software).
                </doc>
                <attribute name="version" type="NX_CHAR">
                    <doc>
                         Either version with build number, commit hash, or description of an
                         (online) repository where the source code of the program and build
                         instructions can be found so that the program can be configured in
                         such a way that result files can be created ideally in a
                         deterministic manner.
                    </doc>
                </attribute>
                <attribute name="program_url" recommended="true" type="NX_CHAR">
                    <doc>
                         Website of the software.
                    </doc>
                </attribute>
            </field>
        </group>
        <group maxOccurs="unbounded" minOccurs="1" name="operator" type="NXuser">
            <doc>
                 Contact information of at least the user of the instrument or the
                 investigator who performed this experiment. Adding multiple users if
                 relevant is recommended.
            </doc>
            <field name="name" type="NX_CHAR">
                <doc>
                     Name of the user.
                </doc>
            </field>
            <field name="affiliation" type="NX_CHAR">
                <doc>
                     Name of the affiliation of the user at the point in time when
                     the experiment was performed.
                </doc>
            </field>
            <field name="address" type="NX_CHAR">
                <doc>
                     Full address (street, street number, ZIP, city, country)
                     of the user's affiliation.
                </doc>
            </field>
            <field name="email" type="NX_CHAR">
                <doc>
                     Email address of the user.
                </doc>
            </field>
            <field name="orcid" recommended="true" type="NX_CHAR">
                <doc>
                     Author ID defined by https://orcid.org/.
                </doc>
            </field>
            <field name="telephone_number" recommended="true" type="NX_CHAR">
                <doc>
                     Official telephone number of the user.
                </doc>
            </field>
        </group>
        <group type="NXinstrument">
            <doc>
                 General properties of the temperature dependent IV curve
                 measurements equipment
            </doc>
            <group name="IVvoltage_source" type="NXsensor">
                <doc>
                     Specify the used voltage source used in the voltage
                     sweep for the IV measurement.
                </doc>
                <field name="model" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text desribing the model and make of the voltage source
                         which is used for the IV sweep measurement.
                    </doc>
                </field>
                <field name="name" optional="true" type="NX_CHAR">
                    <doc>
                         Custom name of the voltage source for the IV sweep given
                         by the user/institution.
                    </doc>
                </field>
                <field name="measurement" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text describing the measurement performed in a few words.
                    </doc>
                </field>
                <field name="type" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text describing the type of voltage setting: an internal sweep
                         using the functionality of the voltage supply, or a
                         set/wait/read/repeat mechanism.
                    </doc>
                </field>
            </group>
            <group name="IVcurrent_source" type="NXsensor">
                <doc>
                     Specify the used current source used in the voltage sweep
                     for the IV measurement.&quot;
                </doc>
                <field name="model" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text desribing the model and make of the current source
                         which is used for the IV sweep measurement.
                    </doc>
                </field>
                <field name="name" optional="true" type="NX_CHAR">
                    <doc>
                         Custom name of the current source for the IV sweep given
                         by the user/institution
                    </doc>
                </field>
                <field name="measurement" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text describing the measurement performed in a few words
                    </doc>
                </field>
                <field name="type" optional="true" type="NX_CHAR">
                    <doc>
                         Free-text describing the type of current measuring: an internal
                         sweep using the functionality of the voltage supply,
                         or a set/wait/read/repeat mechanism.
                    </doc>
                </field>
            </group>
            <group name="calibration" optional="true" type="NXsubentry">
                <doc>
                     Calibration of the temperature sensor is possible
                </doc>
                <field name="calibration_time" type="NX_DATE_TIME">
                    <doc>
                         ISO8601 datum when calibration was last performed
                         before this measurement. UTC offset should be specified.
                    </doc>
                </field>
            </group>
            <group name="temperature_control" optional="true" type="NXsubentry">
                <doc>
                     Describes the system for controlling the temperature
                     if temperature control was used.
                </doc>
                <field name="type" type="NX_CHAR">
                    <doc>
                         What kind of temperature control was used?
                         PID, custom temp control?
                    </doc>
                </field>
                <group name="PID_settings" optional="true" type="NXenvironment">
                    <doc>
                         Specify the settings of the PID temperature controller:
                         K_p, K_i, and K_d values used for the temperature control
                    </doc>
                    <field name="K_p_value" type="NX_NUMBER">
                        <doc>
                             Proportional term. The proportional term produces an output value
                             that is proportional to the current error value.
                             The proportional response can be adjusted by multiplying the error
                             by a constant Kp, called the proportional gain constant.
                        </doc>
                    </field>
                    <field name="K_i_value" type="NX_NUMBER">
                        <doc>
                             The contribution from the integral term is proportional to both
                             the magnitude of the error and the duration of the error.
                             The integral in a PID controller is the sum of the instantaneous
                             error over time and gives the accumulated offset that should have
                             been corrected previously. The accumulated error is then
                             multiplied by the integral gain (Ki) and added to the
                             controller output.
                        </doc>
                    </field>
                    <field name="K_d_value" type="NX_NUMBER">
                        <doc>
                             The derivative of the process error is calculated by determining
                             the slope of the error over time and multiplying this rate of
                             change by the derivative gain K_d. The magnitude of the
                             contribution of the derivative term to the overall control
                             action is termed the derivative gain, K_d
                        </doc>
                    </field>
                </group>
                <field name="temp_sensor_type" type="NX_CHAR">
                    <doc>
                         Specify the temperature sensor that was used
                    </doc>
                    <enumeration>
                        <item value="thermocouple"/>
                        <item value="thermistor"/>
                        <item value="RTD"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="other_temp_sensor" optional="true" type="NX_CHAR">
                    <doc>
                         If you specified 'other' as temperature sensor,
                         please write down what it is.
                    </doc>
                </field>
                <field name="raw_temp_data" optional="true" type="NX_NUMBER">
                    <doc>
                         Data of the most principal measurement of the temperature.
                         For example resistance of a Pt1000.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="N_raw_temp_data"/>
                    </dimensions>
                </field>
                <field name="conversion_function" optional="true" type="NX_CHAR">
                    <doc>
                         Algebraic function that is used to determine temperature from the
                         raw_temp_data. All values should be given in SI units.
                    </doc>
                </field>
            </group>
        </group>
        <group type="NXsample">
            <doc>
                 Properties of the sample, its history, the sample environment and
                 experimental conditions (e.g. surrounding medium, temperature,
                 pressure etc.), along with the data (data type, wavelength array,
                 measured data).
            </doc>
            <field name="sample_name" type="NX_CHAR">
                <doc>
                     Descriptive name of the sample
                </doc>
            </field>
            <field name="sample_history" type="NX_CHAR">
                <doc>
                     Ideally, a reference to the location or a unique (globally persistent)
                     identifier (e.g.) of e.g. another file which gives as many as possible
                     details of the material, its microstructure. In the case that such a
                     detailed history of the sample is not available, use this field as a
                     free-text description to specify details of the sample and its
                     preparation.
                </doc>
            </field>
            <field name="preparation_date" recommended="true" type="NX_DATE_TIME">
                <doc>
                     ISO 8601 date with time zone specified. UTC offset should be specified.
                </doc>
            </field>
            <field name="data_identifier" type="NX_NUMBER" units="NX_UNITLESS">
                <doc>
                     An identifier to correlate data to the experimental conditions,
                     if several were used in this measurement; typically an index of 0 - N
                </doc>
            </field>
            <field name="measured_data" type="NX_NUMBER">
                <doc>
                     Resulting data from the measurement, described by data type.
                </doc>
                <dimensions rank="3">
                    <dim index="1" value="N_different_temperatures"/>
                    <dim index="2" value="N_different_voltages"/>
                    <dim index="3" value="N_variables"/>
                </dimensions>
            </field>
            <field name="environment_conditions" optional="true" type="NX_CHAR">
                <doc>
                     Information about external parameters that have influenced the sample.
                </doc>
            </field>
            <field name="varied_parameters" optional="true" type="NX_CHAR">
                <doc>
                     Indicates which parameter was changed. Its definition must exist below.
                     The specified variable has to be number_of_runs long,
                     providing the parameters for each data set.
                </doc>
                <enumeration>
                    <item value="temperature"/>
                </enumeration>
            </field>
        </group>
        <group name="plot" optional="true" type="NXdata">
            <doc>
                 A default view of the data. The current (y-axis) should be plotted
                 against the voltage (x-axis) with color coding for the temperature
                 of each IV-curve.
            </doc>
            <attribute name="axes">
            </attribute>
        </group>
    </group>
</definition>
