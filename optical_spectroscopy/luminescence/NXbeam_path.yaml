# A draft of a new base class to describe a beam path consisting of one or
# more optical elements (e.g. a beam path in a luminescence setup).

category: base
doc: |
  A beam path consisting of one or more optical elements.

  NXbeam_path is used in NXluminescence to describe the beam path, i.e. the
  arrangement of optical elements between the excitation source and the 
  sample or between the sample and the detector unit.

(NXbeam_path):
  doc: "Describe the relevant optical elements in the beam path by using
        the appropriate sub classes. You may use as many elements as needed,
        also several elements of the same type. Capital letters in the names
        of fields can be replaced, e.g. lens_NUMBER can be lens_1, lens_2
        or lens_first etc."

  # Should we define intensity (loss), polarization state (before/after),
  #   beam profile etc.?

  # Define or use base classes NXlens_opt, NXfilter (defined), NXfiber, 
  #     NXmirror (defined), NXprism, NXpolarizer_opt (NXpolarizer is spin 
  #     polarizer), NXaperture (defined), NXpinhole (defined), 
  #     NXdisk_chopper (defined), NXgrating (defined), waveplate/retarder
  # Some of the classes might be similar, so one has to decide which one to use

  # [x] Use NXtransformations once (not for each element) and add \@depends_on
  #     to each element which refers to the previous element to define a chain
  # [ ] do not use NXcollection (empty base class; throws an error message)
  # [x] Name elements e.g. "lens_NUMBER" or "lens_INDEX". Capital letters can
  #     be replaced (so we can have lens_1, lens_2, ... for example)
  # [ ] use NXgeometry instead of describing the substrate and coating (or in
  #     addition?) to describe more complex cases (layer structures etc.)
  # [ ] Check already existing NeXus base classes if they properly describe
  #     optical elements

  (NXtransformations):
    doc: "Specify the order of the optical elements."
    
  RADIATION_SOURCE(NXsource):
    # link to RADIATION_SOURCE(NXsource)

  WINDOW(NXaperture): # link to WINDOW in sample_stage
    doc: "This is the same as 'WINDOW' in SAMPLE/sample_stage/varied_parameters
          in NXluminescence."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  pinhole_NUMBER(NXpinhole):
    # doc: "A simple pinhole."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  slit_NUMBER(NXslit):
    # doc: "A simple slit."
    # For more complex geometries, NXaperture should be used.
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  aperture_NUMBER(NXaperture):
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  crystal_NUMBER(NXcrystal):
    # doc: "A crystal monochromator or analyzer."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  mirror_NUMBER(NXmirror):
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  filter_NUMBER(NXfilter):
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  attenuator_NUMBER(NXattenuator):
    # doc: "A device that reduces the intensity of a beam by attenuation."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  dispersive_element_NUMBER(NXgrating):
    doc: "A diffraction grating. Define relevant parameters in the
          corresponding fields, e.g. order of diffration (diffraction_order)
          or angular dispersion (angular_dispersion)."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."
    type:
      exists: recommended
      doc: "Define the type of the grating (e.g. SR or VPH grating)."
    angular_dispersion(NX_NUMBER):
      doc: "Dispersion of the grating in nm/mm."

  chopper_NUMBER(NXdisk_chopper): 
    # doc: "A chopper, i.e. a device blocking the beam in a temporal periodic
    #      pattern."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  (NXmonochromator):
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  # ====== New base classes (need to be created): ======

  polarizer_NUMBER(NXpolarizer_opt):
    # define: type (dichroic, linear, circular etc.), angle/position,
    #         transmissivity, reflectivity, coating, Brewster angle, ...
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  beam_splitter_NUMBER(NXbeam_splitter):
    doc: "A beam splitter splitting the light beam in two."
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  waveplate_NUMBER(NXwaveplate): # or NXretarder?
    doc: "A device that changes the polarization state of a light beam."
    # define: type (lambda/2, lambda/4 etc.), material, index of refraction
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  lens_NUMBER(NXlens_opt):
    doc: "An optical lens."
    # define: type (convex, concave etc.), material, index of refraction,
    #         focal length, curvature, thickness, coating, reflection ...
    # Note: NXlens_em is a new base class defined for electro-magnetic or
    #       compund lenses (used in e.g. NXapm)
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."

  fiber_NUMBER(NXfiber): # or NXwaveguide? Can we use/modify NXguide?
    doc: "An optical fiber."
    # define: type/mode, material, refractive index, length, wavelength range,
    #         bandwidth or transfer rate, numerical aperture (angle)
    #         core diameter, clad diameter
    \@depends_on: "Use this attribute to point to the previous optical element.
                  The first element after the excitation source should point to
                  RADIATION_SOURCE(NXsource)."
  
