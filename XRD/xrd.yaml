# FAIRmat consortium 07/2022
# Draft version of a NeXus application definition
# for x-ray scattering experiments.

# the doc needs to be a general block, first line providing a short summary, the
# rest details, and possibly references.
# TODO: Add additional information.
doc: This is a general application definition for x-ray scattering experiments
symbols:
  N_wavelengths: Number of wavlengths in the monochromated beam
  N_detectors: Number of detection channels
category: application
(NXxrd):
  (NXentry):
    start_time(NX_DATE_TIME):
    (NXuser):
      doc: "Contact information of at least the user of the instrument or the
        investigator who performed this experiment.
        Adding multiple users if relevant is recommended."
      name:
        doc: "Name of the user."
      affiliation:
        doc: "Name of the affiliation of the user at the point in time when the
          experiment was performed."
      address:
        doc: "Full address (street, street number, ZIP, city, country) of the
          user's affiliation."
      email:
        doc: "Email address of the user."
      orcid:
        exists: recommended
        doc: "Author ID defined by https://orcid.org/."
      telephone_number:
        exists: recommended
        doc: "Official telephone number of the user."
    definition:
      \@version:
      \@url:
        doc: "URL where to find further material (documentation, examples) relevant to the application definition"
      enumeration: ["NXxrd"]
    (NXinstrument):
      (NXsource):
        type(NX_CHAR):
          enumeration:
            [
              Synchrotron X-ray source,
              Rotating Anode X-ray,
              Fixed Tube X-ray,
              Free-Electron Laser,
              Metal Jet X-ray,
            ]
        name(NX_CHAR):
        probe(NX_CHAR):
          enumeration: ["x-ray"]
      (NXbeam):
        incident_energy(NX_FLOAT):
      (NXmonochromator):
        exists: optional
        wavelength(NX_FLOAT):
          doc: Optimal diffracted wavelengths
          dimensions:
            rank: 1
            dim: [[1, N_wavelengths]]
          unit: NX_WAVELENGTH
        (NXslit):
          doc: Slits of the monochromator
      (NXdetector):
        # we have the problem that unit depends on the detector type
        # I cannot see the NXdetector having the option for counters etc.
        # maybe we should add an item: detector_type
        # and enum listing something like:
        # [diode array, CCD array, 2D CMOS, 2D CCD, PMT, scintillation counter, ...]
        # they may have further parameters, such as:
        # operation voltage (PMT, MCP, scintillation detectors)

        # it may be handy to add here NXtransformations
        # to provide the position of the detector
        # however the sample comes first, thus
        # the transformation may rely on something
        # defined later in the text. It should be no problem,
        # but some may find it confusing at the first sight.
        # TODO:
        # Replace with NXtransformations
        # and add support for 2D detectors
        polar_angle(NX_FLOAT):
          dimensions:
            rank: 1
            dim: [[1, N_detectors]]
          unit: NX_ANGLE
        data(NX_INT):
          doc: Detector signal
          dimensions:
            rank: 1
            dim: [[1, N_detectors]]
    (NXsample):
      # name is good, but we need sample ID for sure
      # and some description of the chemistry
      # state of the material:
      # [powder, solid, liquid, solution]
      # it may have:
      # dimensions, such as width, height, thickness
      # volume
      # concentration
      #
      # we may want to have situation mandatory (atmosphere)
      name(NX_CHAR):
      chemical_formula(NX_CHAR):
    (NXmonitor):
      exists: optional
      mode(NX_CHAR):
        enumeration: ["monitor", "timer"]
        doc: |
          Count to a preset value based on either clock time (timer) 
          or received monitor counts (monitor).
      preset(NX_FLOAT):
        doc: Preset value for time or monitor
      integral(NX_FLOAT):
        doc: Total integral monitor counts
        unit: NX_ANY
    # NXdata is about the default look of your data
    data(NXdata):
      polar_angle(link):
        doc: Should contain a link to polar angle in /NXentry/NXinstrument/NXdetector
      data(link):
        doc: Should contain a link to data in /Nxentry/Nxinstrument/Nxdetector
    (NXprocess):
      exists: optional
      doc: |
        Description of a processing or analysis step, such as the 
        baseline extraction or azimuth integration.
        Add additional fields as needed to describe value(s) of 
        any variable, parameter, or term related to 
        the NXprocess step. Be sure to include units attributes 
        for all numerical fields.
